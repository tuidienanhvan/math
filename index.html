<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toán 7: Thế Giới Số Hữu Tỉ - Phiên Bản Nâng Cao</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Roboto:wght@300;400;500;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- GSAP Animation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- ScrollTrigger -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --retro-red: #8a0303;
            --retro-blue: #002b5c;
            --retro-gold: #d4af37;
            --retro-cream: #f4f1ea;
            --retro-paper: #ffffff;
            --text-color: #333333;
            --success-green: #28a745;
            --warning-orange: #ff6b6b;
            --purple-accent: #6c63ff;
            --gradient-1: linear-gradient(135deg, #002b5c 0%, #004080 100%);
            --gradient-2: linear-gradient(135deg, #8a0303 0%, #c41e1e 100%);
            --gradient-3: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--retro-cream);
            font-family: 'Poppins', 'Roboto', sans-serif;
            color: var(--text-color);
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(212, 175, 55, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(138, 3, 3, 0.05) 0%, transparent 50%),
                radial-gradient(#e0ddd5 1px, transparent 1px);
            background-size: 100% 100%, 100% 100%, 20px 20px;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, .display-font {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
        }

        /* Smooth Scroll */
        html {
            scroll-behavior: smooth;
        }

        /* Loading Animation */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--retro-cream);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s, visibility 0.5s;
        }

        .loader.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--retro-blue);
            border-top: 5px solid var(--retro-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--retro-blue) 0%, #001f42 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 4px solid var(--retro-gold);
        }

        header h1 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-size: 2.5rem;
        }

        .badge-header {
            background: var(--retro-gold);
            color: var(--retro-blue);
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            box-shadow: 0 2px 10px rgba(212, 175, 55, 0.4);
        }

        /* Section Container */
        .section-container {
            margin-bottom: 80px;
            position: relative;
            /* Animation applied via JS */
            opacity: 0; 
            transform: translateY(30px);
        }

        .section-title {
            position: relative;
            padding-left: 25px;
            margin-bottom: 30px;
            font-size: 2rem;
            color: var(--retro-blue);
            display: inline-block;
        }

        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 6px;
            background: linear-gradient(to bottom, var(--retro-red), var(--retro-gold));
            border-radius: 10px;
        }

        .section-title .material-icons {
            vertical-align: middle;
            font-size: 2.2rem;
            margin-right: 10px;
            color: var(--retro-red);
        }

        /* Modern Cards */
        .card {
            border: none;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            background: white;
            height: 100%;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.12);
        }

        .card-header {
            background: var(--gradient-1);
            color: white;
            font-weight: 600;
            padding: 15px 20px;
            border: none;
            font-size: 1.1rem;
            letter-spacing: 0.5px;
        }

        .card-header.bg-gold { background: var(--gradient-3); color: var(--retro-blue); }
        .card-header.bg-gradient-2 { background: var(--gradient-2); }

        /* Buttons */
        .btn-retro {
            background: linear-gradient(135deg, var(--retro-red), #b00b0b);
            color: white;
            border: none;
            font-weight: 600;
            border-radius: 12px;
            padding: 12px 30px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(138, 3, 3, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-retro:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(138, 3, 3, 0.4);
            color: white;
        }

        .btn-retro-blue {
            background: linear-gradient(135deg, var(--retro-blue), #004080);
            box-shadow: 0 4px 15px rgba(0, 43, 92, 0.3);
            color: white;
            border: none;
            font-weight: 600;
            border-radius: 12px;
            padding: 12px 30px;
        }

        .btn-retro-blue:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 43, 92, 0.4);
            color: white;
        }

        /* Inputs */
        .retro-input {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 12px 20px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .retro-input:focus {
            outline: none;
            border-color: var(--retro-blue);
            box-shadow: 0 0 0 4px rgba(0, 43, 92, 0.1);
            transform: translateY(-2px);
        }

        /* Interactive Area */
        .interactive-area {
            background: rgba(255,255,255,0.8);
            border: 3px dashed var(--retro-blue);
            padding: 30px;
            border-radius: 20px;
            position: relative;
            backdrop-filter: blur(5px);
        }

        .try-it-badge {
            position: absolute;
            top: -15px;
            right: -10px;
            background: var(--retro-gold);
            color: var(--retro-blue);
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            transform: rotate(5deg);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
            z-index: 10;
            animation: wiggle 3s ease-in-out infinite;
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(5deg); }
            50% { transform: rotate(-5deg); }
        }

        /* Result Boxes */
        .result-box {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .result-box:hover {
            border-color: var(--retro-blue);
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .result-box strong {
            font-size: 1.4rem;
            color: var(--retro-blue);
            display: block;
            margin-top: 5px;
            word-break: break-all;
        }

        /* Number Line Canvas */
        #numberLineContainer {
            background: white;
            border: 3px solid var(--retro-blue);
            border-radius: 15px;
            height: 200px;
            overflow: hidden;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }

        /* Comparison Circle */
        .comparison-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            border: 4px solid var(--retro-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--retro-blue);
            margin: 0 auto;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 250px;
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        /* Custom Slider */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--retro-red), var(--retro-blue));
            outline: none;
            margin: 20px 0;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--retro-gold);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }

        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        /* Game Buttons */
        .game-number-btn {
            font-size: 1.5rem;
            margin: 8px;
            min-width: 90px;
            min-height: 60px;
            border-radius: 15px;
            border: 3px solid var(--retro-blue);
            background: white;
            font-weight: 700;
            transition: all 0.2s ease;
            box-shadow: 0 4px 0 var(--retro-blue);
        }

        .game-number-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 var(--retro-blue);
            background: var(--retro-cream);
        }

        .game-number-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 var(--retro-blue);
        }

        .game-number-btn.btn-success {
            background: var(--success-green) !important;
            border-color: var(--success-green) !important;
            box-shadow: 0 4px 0 #1e7e34 !important;
            color: white;
        }

        .game-number-btn.btn-danger {
            background: var(--warning-orange) !important;
            border-color: var(--warning-orange) !important;
            box-shadow: 0 4px 0 #d9534f !important;
            color: white;
        }

        /* Drag and Drop */
        .drop-zone {
            min-height: 120px;
            border: 3px dashed #ccc;
            border-radius: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.6);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .drop-zone.drag-over {
            border-color: var(--retro-gold);
            background: rgba(212, 175, 55, 0.1);
            transform: scale(1.02);
        }

        .draggable {
            cursor: grab;
            margin: 5px;
        }
        
        .draggable:active {
            cursor: grabbing;
        }

        /* Info Cards */
        .info-card {
            background: var(--retro-blue);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 43, 92, 0.2);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 { font-size: 1.8rem !important; }
            .section-title { font-size: 1.5rem; }
            .card-body { padding: 1.5rem; }
            .game-number-btn { min-width: 70px; font-size: 1.2rem; }
            .interactive-area { padding: 20px; }
            .comparison-circle { width: 60px; height: 60px; font-size: 1.5rem; }
        }

        /* Utility */
        .hover-lift { transition: transform 0.3s ease; }
        .hover-lift:hover { transform: translateY(-5px); }
    </style>
</head>
<body>

    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="text-center">
                <span class="badge-header">
                    <i class="fas fa-graduation-cap"></i> Toán Học Lớp 7
                </span>
                <h1 class="display-4 fw-bold mt-3">Thế Giới Số Hữu Tỉ \(\mathbb{Q}\)</h1>
                <p class="mb-0 mt-2" style="opacity: 0.9;">
                    <i class="fas fa-lightbulb"></i> Khám phá vẻ đẹp cổ điển của toán học
                </p>
            </div>
        </div>
    </header>

    <div class="container mt-5">

        <!-- SECTION 1: DEFINITION & ANALYZER -->
        <div class="section-container">
            <h2 class="section-title">
                <span class="material-icons">filter_1</span>
                Định Nghĩa & Thực Hành
            </h2>

            <div class="row g-4">
                <!-- Theory -->
                <div class="col-lg-5">
                    <div class="card hover-lift">
                        <div class="card-header">
                            <i class="fas fa-book-open"></i> Lý Thuyết Cơ Bản
                        </div>
                        <div class="card-body">
                            <div class="info-card">
                                <h5><i class="fas fa-question-circle"></i> Số Hữu Tỉ Là Gì?</h5>
                                <p class="mb-2">
                                    Là số viết được dưới dạng phân số \(\frac{a}{b}\) với \(a, b \in \mathbb{Z}\), \(b \neq 0\).
                                </p>
                            </div>

                            <ul class="list-unstyled">
                                <li class="mb-3 p-3 bg-light rounded border border-secondary border-opacity-10">
                                    <i class="fas fa-check-circle text-success"></i>
                                    <strong>Ký hiệu:</strong> \(\mathbb{Q}\)
                                </li>
                                <li class="mb-3 p-3 bg-light rounded border border-secondary border-opacity-10">
                                    <i class="fas fa-layer-group text-primary"></i>
                                    <strong>Bao gồm:</strong> Số nguyên, số thập phân, phân số
                                </li>
                                <li class="p-3 bg-light rounded border border-secondary border-opacity-10">
                                    <i class="fas fa-lightbulb text-warning"></i>
                                    <strong>Ví dụ:</strong> \(-0.5 = \frac{-1}{2}\), \(3 = \frac{3}{1}\)
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Interactive Tool -->
                <div class="col-lg-7">
                    <div class="interactive-area">
                        <div class="try-it-badge">
                            <i class="fas fa-hand-pointer"></i> Thử Ngay!
                        </div>
                        <h5 class="fw-bold mb-3" style="color: var(--retro-blue);">
                            <i class="fas fa-calculator"></i> Bộ Phân Tích Số
                        </h5>
                        <p class="text-muted small mb-3">
                            Nhập bất kỳ số nào để xem cấu tạo chi tiết:
                        </p>

                        <div class="input-group mb-4">
                            <input type="text" id="inputNum" class="form-control retro-input fs-5" 
                                   placeholder="VD: 1.5, -3/4, 2" value="1.5">
                            <button class="btn btn-retro" onclick="analyzeNumber()">
                                <i class="fas fa-search"></i> PHÂN TÍCH
                            </button>
                        </div>

                        <div class="row g-3">
                            <div class="col-4">
                                <div class="result-box">
                                    <small class="text-muted d-block mb-1">Thập Phân</small>
                                    <strong id="resDecimal">--</strong>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="result-box">
                                    <small class="text-muted d-block mb-1">Phân Số</small>
                                    <strong id="resFraction">--</strong>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="result-box">
                                    <small class="text-muted d-block mb-1">Loại</small>
                                    <strong id="resType" class="fs-6">--</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 2: NUMBER LINE -->
        <div class="section-container">
            <h2 class="section-title">
                <span class="material-icons">filter_2</span>
                Trục Số & Trực Quan Hóa
            </h2>

            <div class="card">
                <div class="card-header bg-gradient-2">
                    <i class="fas fa-chart-line"></i> Biểu Diễn Số Trên Trục
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-4 mb-3 mb-md-0">
                            <div class="info-card">
                                <h5><i class="fas fa-info-circle"></i> Khái Niệm</h5>
                                <p class="mb-2">
                                    <strong>Số đối:</strong> Hai số đối xứng qua 0, tổng bằng 0.
                                </p>
                                <p class="mb-0">
                                    <strong>GTTĐ |x|:</strong> Khoảng cách từ điểm x đến số 0.
                                </p>
                            </div>
                        </div>

                        <div class="col-md-8">
                            <div id="numberLineContainer">
                                <canvas id="numberLineCanvas"></canvas>
                            </div>
                            <div class="text-center mt-3 small fw-bold">
                                <span class="mx-2">
                                    <i class="fas fa-circle" style="color:var(--retro-blue)"></i> Số nhập
                                </span>
                                <span class="mx-2">
                                    <i class="fas fa-circle" style="color:var(--retro-red)"></i> Số đối
                                </span>
                                <span class="mx-2">
                                    <i class="fas fa-arrows-alt-h" style="color:var(--retro-gold)"></i> GTTĐ
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 3: COMPARISON -->
        <div class="section-container">
            <h2 class="section-title">
                <span class="material-icons">filter_3</span>
                So Sánh Số Hữu Tỉ
            </h2>

            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="interactive-area h-100 d-flex flex-column justify-content-center">
                        <div class="try-it-badge">
                            <i class="fas fa-balance-scale"></i> So Sánh
                        </div>

                        <h5 class="fw-bold mb-4 text-center" style="color: var(--retro-blue);">
                            <i class="fas fa-not-equal"></i> Công Cụ So Sánh
                        </h5>

                        <div class="d-flex align-items-center justify-content-center gap-3 mb-4 flex-wrap">
                            <div class="text-center" style="flex: 1; min-width: 100px;">
                                <input type="text" id="compA" class="form-control retro-input text-center fs-4 mb-2" 
                                       value="3/4">
                                <small class="text-muted fw-bold">Số A</small>
                            </div>

                            <div id="comparisonCircle" class="comparison-circle">?</div>

                            <div class="text-center" style="flex: 1; min-width: 100px;">
                                <input type="text" id="compB" class="form-control retro-input text-center fs-4 mb-2" 
                                       value="0.8">
                                <small class="text-muted fw-bold">Số B</small>
                            </div>
                        </div>

                        <div class="text-center">
                            <button class="btn btn-retro-blue px-5 w-75" onclick="compareTwoNumbers()">
                                <i class="fas fa-play"></i> SO SÁNH NGAY
                            </button>
                        </div>

                        <div id="compareExplanation" class="text-center mt-3 p-3 rounded" 
                             style="min-height: 50px;"></div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-header bg-gold">
                            <i class="fas fa-project-diagram"></i> Tính Chất Bắc Cầu
                        </div>
                        <div class="card-body">
                            <div class="alert alert-warning border-warning text-dark">
                                <i class="fas fa-lightbulb"></i>
                                Nếu \(a < b\) và \(b < c\) thì <strong>\(a < c\)</strong>
                            </div>

                            <label class="fw-bold mb-3 text-secondary">
                                <i class="fas fa-edit"></i> Kiểm chứng với 3 số:
                            </label>

                            <div class="d-flex gap-2 align-items-center justify-content-center mb-3 flex-wrap">
                                <input type="number" id="transA" class="form-control retro-input text-center" 
                                       placeholder="a" style="width:70px;">
                                <span class="fw-bold">&lt;</span>
                                <input type="number" id="transB" class="form-control retro-input text-center" 
                                       placeholder="b" style="width:70px;">
                                <span class="fw-bold">&lt;</span>
                                <input type="number" id="transC" class="form-control retro-input text-center" 
                                       placeholder="c" style="width:70px;">
                            </div>

                            <button class="btn btn-retro w-100" onclick="checkTransitive()">
                                <i class="fas fa-check"></i> KIỂM TRA LOGIC
                            </button>

                            <div id="transResult" class="mt-3 p-2 rounded text-center fw-bold"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 4: REAL WORLD -->
        <div class="section-container">
            <h2 class="section-title">
                <span class="material-icons">filter_4</span>
                Ứng Dụng Thực Tế
            </h2>

            <div class="card">
                <div class="card-header" style="background: var(--gradient-3); color: var(--retro-blue);">
                    <i class="fas fa-chart-bar"></i> Mô Phỏng Tài Chính
                </div>
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-5 mb-4 mb-md-0">
                            <h4 class="text-primary mb-3">
                                <i class="fas fa-money-bill-wave"></i> Kinh Tế & Tài Chính
                            </h4>
                            <div class="mb-3">
                                <span class="badge bg-success p-2 mb-1 w-100 text-start">
                                    <i class="fas fa-arrow-up"></i> Số Dương = Lãi / Tài Sản
                                </span>
                                <span class="badge bg-danger p-2 w-100 text-start">
                                    <i class="fas fa-arrow-down"></i> Số Âm = Lỗ / Nợ
                                </span>
                            </div>

                            <label class="fw-bold mb-2 text-muted">
                                <i class="fas fa-sliders-h"></i> Điều chỉnh mức lợi nhuận:
                            </label>
                            <input type="range" id="financeRange" 
                                   min="-100" max="100" step="5" value="0" 
                                   oninput="updateFinance(this.value)">

                            <div class="d-flex justify-content-between fw-bold small mt-2">
                                <span class="text-danger">-100 Tr</span>
                                <span class="text-muted">0</span>
                                <span class="text-success">+100 Tr</span>
                            </div>
                        </div>

                        <div class="col-md-7">
                            <div class="chart-container">
                                <canvas id="financeChart"></canvas>
                            </div>
                            <div class="text-center mt-3">
                                <h2 id="financeValue" class="display-6 fw-bold mb-1">0 Triệu</h2>
                                <span id="financeStatus" class="badge bg-secondary fs-6">
                                    Hòa Vốn
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 5: GAME -->
        <div class="section-container">
            <h2 class="section-title text-center w-100 border-0">
                <span class="material-icons text-dark" style="font-size: 32px;">sports_esports</span>
                Mini-Game: Thử Thách Sắp Xếp
            </h2>

            <div class="card border-4 border-danger">
                <div class="card-header bg-gold text-center">
                    <h4 class="mb-0"><i class="fas fa-trophy"></i> Xếp Số Từ Bé Đến Lớn</h4>
                </div>
                <div class="card-body text-center py-5">
                    
                    <div class="progress mb-4 mx-auto" style="height: 25px; max-width: 500px; border-radius: 20px;">
                        <div id="gameProgress" class="progress-bar bg-gradient-success" role="progressbar" style="width: 0%; transition: width 0.5s;">0/5</div>
                    </div>

                    <div id="gameArea" class="d-flex flex-wrap justify-content-center gap-2 my-4" style="min-height: 80px;">
                        <!-- Buttons generated by JS -->
                    </div>

                    <div id="gameMessage" class="alert alert-info d-inline-block px-5 fw-bold">
                        <i class="fas fa-info-circle"></i> Nhấn "BẮT ĐẦU" để chơi!
                    </div>

                    <div class="mt-4">
                        <button class="btn btn-retro btn-lg px-5 rounded-pill" onclick="startGame()">
                            <i class="fas fa-gamepad"></i> BẮT ĐẦU
                        </button>
                        <div class="mt-3">
                            <strong>Điểm số: <span id="gameScore" class="text-primary">0</span></strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 6: DRAG AND DROP -->
        <div class="section-container">
            <h2 class="section-title">
                <span class="material-icons">filter_5</span>
                Thực Hành Kéo Thả
            </h2>
            
            <div class="card">
                <div class="card-header bg-gradient-2">
                    <i class="fas fa-hand-rock"></i> Phân Loại Số
                </div>
                <div class="card-body">
                    <p class="text-center mb-4 text-muted">
                        <i class="fas fa-info-circle"></i> Kéo các số ở dưới vào đúng nhóm của chúng.
                    </p>

                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="drop-zone" id="positiveZone" data-type="positive">
                                <h6 class="text-success fw-bold"><i class="fas fa-plus-circle"></i> SỐ DƯƠNG</h6>
                                <div class="text-muted small">Thả số dương vào đây</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="drop-zone" id="zeroZone" data-type="zero">
                                <h6 class="text-secondary fw-bold"><i class="fas fa-circle"></i> SỐ 0</h6>
                                <div class="text-muted small">Thả số 0 vào đây</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="drop-zone" id="negativeZone" data-type="negative">
                                <h6 class="text-danger fw-bold"><i class="fas fa-minus-circle"></i> SỐ ÂM</h6>
                                <div class="text-muted small">Thả số âm vào đây</div>
                            </div>
                        </div>
                    </div>

                    <div id="dragNumbers" class="d-flex flex-wrap justify-content-center gap-3 mb-3 p-3 bg-light rounded">
                        <!-- Numbers generated by JS -->
                    </div>

                    <div class="text-center">
                        <button class="btn btn-retro me-2" onclick="initDragDrop()">
                            <i class="fas fa-sync"></i> TẠO MỚI
                        </button>
                        <button class="btn btn-retro-blue" onclick="checkDragDropAnswers()">
                            <i class="fas fa-check-double"></i> KIỂM TRA KẾT QUẢ
                        </button>
                    </div>
                    <div id="dragResult" class="text-center mt-3 fw-bold"></div>
                </div>
            </div>
        </div>

    </div>

    <!-- Footer -->
    <footer>
        <div class="container text-center">
            <p class="mb-2 fw-bold fs-5">
                <i class="fas fa-graduation-cap"></i> Toán Học Vui & Dễ Hiểu
            </p>
            <p class="mb-0 small opacity-75">
                © 2025 PiAI Technology & Education
            </p>
        </div>
    </footer>

    <!-- JAVASCRIPT -->
    <script>
        // Use ScrollTrigger
        gsap.registerPlugin(ScrollTrigger);

        // ==================== UTILITIES ====================
        function parseRational(str) {
            str = String(str).trim();
            if (str.includes('/')) {
                const parts = str.split('/');
                if (parts.length === 2) {
                    const num = parseFloat(parts[0]);
                    const den = parseFloat(parts[1]);
                    if (den === 0) return NaN;
                    return num / den;
                }
            }
            return parseFloat(str);
        }

        function toFraction(val) {
            if (val === 0) return "0";
            if (!Number.isFinite(val)) return "N/A";
            const tolerance = 1.0E-6;
            let h1 = 1, h2 = 0, k1 = 0, k2 = 1;
            let b = val;
            do {
                const a = Math.floor(b);
                let aux = h1; h1 = a * h1 + h2; h2 = aux;
                aux = k1; k1 = a * k1 + k2; k2 = aux;
                b = 1 / (b - a);
            } while (Math.abs(val - h1 / k1) > val * tolerance);
            
            if (k1 < 0) { h1 = -h1; k1 = -k1; }
            return `${h1}/${k1}`;
        }

        function playSound(type) {
            // Simple oscillator sound (optional, browser may block audio context)
            try {
                const context = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(context.destination);

                if (type === 'success') {
                    oscillator.frequency.value = 523.25; // C5
                    gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.3);
                    oscillator.start();
                    oscillator.stop(context.currentTime + 0.3);
                } else if (type === 'error') {
                    oscillator.frequency.value = 150; 
                    oscillator.type = 'sawtooth';
                    gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.3);
                    oscillator.start();
                    oscillator.stop(context.currentTime + 0.3);
                }
            } catch(e) { console.log('Audio error:', e); }
        }

        // ==================== ANALYSIS TOOL ====================
        function analyzeNumber() {
            const input = document.getElementById('inputNum').value;
            const val = parseRational(input);

            if (isNaN(val)) {
                alert("Vui lòng nhập số hợp lệ!");
                return;
            }

            // Animate results
            gsap.from(".result-box strong", {
                scale: 1.5,
                color: "#ff6b6b",
                duration: 0.5,
                stagger: 0.1
            });

            document.getElementById('resDecimal').innerText = val.toFixed(4);
            document.getElementById('resFraction').innerText = toFraction(val);

            const typeEl = document.getElementById('resType');
            if (val > 0) {
                typeEl.innerHTML = '<span class="text-success"><i class="fas fa-plus"></i> Dương</span>';
            } else if (val < 0) {
                typeEl.innerHTML = '<span class="text-danger"><i class="fas fa-minus"></i> Âm</span>';
            } else {
                typeEl.innerHTML = '<span class="text-secondary"><i class="fas fa-circle"></i> Số 0</span>';
            }

            drawNumberLine(val);
            playSound('success');
        }

        // ==================== NUMBER LINE ====================
        function drawNumberLine(userVal) {
            const canvas = document.getElementById('numberLineCanvas');
            const ctx = canvas.getContext('2d');
            const container = document.getElementById('numberLineContainer');

            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;

            const w = canvas.width;
            const h = canvas.height;
            const midY = h / 2;
            const centerX = w / 2;

            ctx.clearRect(0, 0, w, h);

            const absMax = Math.max(Math.abs(userVal), 5);
            const range = absMax * 1.4;
            const pxPerUnit = (w / 2) / range;

            // Draw axis
            ctx.beginPath();
            ctx.moveTo(10, midY);
            ctx.lineTo(w - 10, midY);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Arrows
            ctx.fillStyle = '#333';
            ctx.fillText("▶", w - 15, midY + 4);
            ctx.fillText("◀", 5, midY + 4);

            // Ticks
            const startTick = -Math.floor(range);
            const endTick = Math.floor(range);
            let step = 1;
            if (range > 15) step = 5;
            if (range > 50) step = 10;

            ctx.textAlign = "center";
            ctx.font = "12px Poppins";
            ctx.fillStyle = "#666";

            for (let i = startTick; i <= endTick; i += step) {
                const x = centerX + (i * pxPerUnit);
                ctx.beginPath();
                ctx.moveTo(x, midY - 6);
                ctx.lineTo(x, midY + 6);
                ctx.stroke();
                ctx.fillText(i, x, midY + 20);
            }

            // Absolute Value Line
            if (userVal !== 0) {
                const xUser = centerX + (userVal * pxPerUnit);
                ctx.beginPath();
                ctx.moveTo(centerX, midY - 25);
                ctx.lineTo(xUser, midY - 25);
                ctx.strokeStyle = "#d4af37";
                ctx.lineWidth = 3;
                ctx.stroke();
                
                ctx.fillStyle = "#d4af37";
                ctx.font = "bold 12px Poppins";
                ctx.fillText(`|${userVal.toFixed(1)}| = ${Math.abs(userVal).toFixed(1)}`, (centerX + xUser) / 2, midY - 32);
            }

            // Points
            function drawPoint(val, color, label) {
                const x = centerX + (val * pxPerUnit);
                ctx.beginPath();
                ctx.arc(x, midY, 6, 0, 2 * Math.PI);
                ctx.fillStyle = color;
                ctx.fill();
                ctx.strokeStyle = "white";
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.fillStyle = color;
                ctx.font = "bold 14px Poppins";
                ctx.fillText(val.toFixed(1), x, midY + 35);
            }

            drawPoint(userVal, "#002b5c", "Số nhập");
            if (userVal !== 0) {
                drawPoint(-userVal, "#8a0303", "Đối");
            }
            
            // Draw Zero
            ctx.beginPath();
            ctx.arc(centerX, midY, 4, 0, 2*Math.PI);
            ctx.fillStyle = '#333';
            ctx.fill();
            ctx.fillText('0', centerX, midY - 10);
        }

        // ==================== COMPARISON ====================
        function compareTwoNumbers() {
            const aStr = document.getElementById('compA').value;
            const bStr = document.getElementById('compB').value;
            const a = parseRational(aStr);
            const b = parseRational(bStr);
            const circle = document.getElementById('comparisonCircle');
            const explain = document.getElementById('compareExplanation');

            if (isNaN(a) || isNaN(b)) {
                circle.innerText = "?";
                explain.className = "alert alert-warning";
                explain.innerHTML = "Vui lòng nhập số hợp lệ!";
                return;
            }

            let symbol, color, msg, cls;
            if (a < b) {
                symbol = "<"; color = "var(--retro-red)";
                msg = `<strong>${a}</strong> nằm bên TRÁI <strong>${b}</strong>`;
                cls = "alert alert-info";
            } else if (a > b) {
                symbol = ">"; color = "var(--retro-blue)";
                msg = `<strong>${a}</strong> nằm bên PHẢI <strong>${b}</strong>`;
                cls = "alert alert-primary";
            } else {
                symbol = "="; color = "var(--success-green)";
                msg = "Hai số bằng nhau";
                cls = "alert alert-success";
            }

            circle.innerText = symbol;
            circle.style.borderColor = color;
            circle.style.color = color;
            explain.className = cls;
            explain.innerHTML = msg;

            gsap.fromTo(circle, {scale: 1, rotation: 0}, {scale: 1.2, rotation: 360, duration: 0.5});
            playSound('success');
        }

        // ==================== TRANSITIVE ====================
        function checkTransitive() {
            const a = parseFloat(document.getElementById('transA').value);
            const b = parseFloat(document.getElementById('transB').value);
            const c = parseFloat(document.getElementById('transC').value);
            const res = document.getElementById('transResult');

            if (isNaN(a) || isNaN(b) || isNaN(c)) {
                res.innerHTML = "Nhập đủ 3 số để kiểm tra!";
                res.className = "text-warning";
                return;
            }

            if (a < b && b < c) {
                res.innerHTML = `<span class="text-success"><i class="fas fa-check-circle"></i> ĐÚNG! Suy ra ${a} < ${c}</span>`;
                playSound('success');
            } else {
                res.innerHTML = `<span class="text-danger"><i class="fas fa-times-circle"></i> SAI ĐIỀU KIỆN! Cần a < b và b < c</span>`;
                playSound('error');
            }
            gsap.from(res, {opacity: 0, y: 10, duration: 0.3});
        }

        // ==================== FINANCE CHART (Chart.js) ====================
        let financeChart = null;
        function initFinanceChart() {
            const ctx = document.getElementById('financeChart').getContext('2d');
            financeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Tài Chính'],
                    datasets: [{
                        label: 'Giá trị (Triệu VNĐ)',
                        data: [0],
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            min: -100,
                            max: 100
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function updateFinance(val) {
            const v = parseFloat(val);
            const display = document.getElementById('financeValue');
            const status = document.getElementById('financeStatus');
            
            display.innerText = (v > 0 ? "+" : "") + v + " Triệu";

            let color = 'rgba(108, 117, 125, 0.6)'; // gray
            let statusText = "Hòa Vốn";
            let badgeClass = "badge bg-secondary";

            if (v > 0) {
                color = 'rgba(40, 167, 69, 0.8)'; // green
                statusText = "LÃI (Tài sản tăng)";
                badgeClass = "badge bg-success";
            } else if (v < 0) {
                color = 'rgba(220, 53, 69, 0.8)'; // red
                statusText = "LỖ (Nợ / Thâm hụt)";
                badgeClass = "badge bg-danger";
            }

            status.innerText = statusText;
            status.className = badgeClass;

            if (financeChart) {
                financeChart.data.datasets[0].data = [v];
                financeChart.data.datasets[0].backgroundColor = color;
                financeChart.data.datasets[0].borderColor = color.replace('0.8', '1');
                financeChart.update();
            }
        }

        // ==================== GAME: SORTING ====================
        let gameNumbers = [];
        let currentStep = 0;
        let sortedNumbers = [];
        let gameScore = 0;

        function startGame() {
            const area = document.getElementById('gameArea');
            area.innerHTML = "";
            gameNumbers = [];
            currentStep = 0;
            
            // Random 5 numbers
            for (let i=0; i<5; i++) {
                let n = (Math.floor(Math.random() * 40) - 20) / 2;
                gameNumbers.push(n);
            }
            sortedNumbers = [...gameNumbers].sort((a,b) => a-b);
            
            // Shuffle display
            const shuffled = [...gameNumbers].sort(() => Math.random() - 0.5);

            shuffled.forEach(num => {
                const btn = document.createElement('button');
                btn.className = "btn game-number-btn";
                btn.innerText = num;
                btn.onclick = () => checkGameMove(num, btn);
                area.appendChild(btn);
            });

            document.getElementById('gameMessage').className = "alert alert-info d-inline-block px-5 fw-bold";
            document.getElementById('gameMessage').innerHTML = '<i class="fas fa-search"></i> Tìm số BÉ NHẤT...';
            updateProgress();
        }

        function checkGameMove(val, btn) {
            if (val === sortedNumbers[currentStep]) {
                btn.className = "btn game-number-btn btn-success";
                btn.disabled = true;
                btn.innerHTML = `<i class="fas fa-check"></i> ${val}`;
                currentStep++;
                gameScore += 10;
                document.getElementById('gameScore').innerText = gameScore;
                updateProgress();

                if (currentStep === sortedNumbers.length) {
                    document.getElementById('gameMessage').className = "alert alert-success fw-bold";
                    document.getElementById('gameMessage').innerHTML = '<i class="fas fa-trophy"></i> CHIẾN THẮNG!';
                    playSound('success');
                    confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
                } else {
                    playSound('success');
                }
            } else {
                btn.className = "btn game-number-btn btn-danger";
                playSound('error');
                setTimeout(() => {
                    if (!btn.disabled) btn.className = "btn game-number-btn";
                }, 600);
                gsap.from(btn, {x: -10, duration: 0.1, repeat: 3, yoyo: true});
            }
        }

        function updateProgress() {
            const pct = (currentStep / 5) * 100;
            const bar = document.getElementById('gameProgress');
            bar.style.width = pct + "%";
            bar.innerText = `${currentStep}/5`;
        }

        // ==================== DRAG AND DROP ====================
        let dragItems = [];
        
        function initDragDrop() {
            const container = document.getElementById('dragNumbers');
            container.innerHTML = '';
            document.getElementById('dragResult').innerText = '';
            
            // Generate random numbers
            const nums = [
                Math.floor(Math.random()*10)+1, 
                -(Math.floor(Math.random()*10)+1),
                0,
                Math.floor(Math.random()*10)+1,
                -(Math.floor(Math.random()*10)+1)
            ];

            nums.sort(() => Math.random() - 0.5);

            nums.forEach((num, idx) => {
                const el = document.createElement('div');
                el.className = 'btn btn-light border shadow-sm draggable fw-bold';
                el.innerText = num;
                el.draggable = true;
                el.dataset.val = num;
                el.id = `drag-${idx}`;
                
                el.addEventListener('dragstart', e => {
                    e.dataTransfer.setData('text/plain', num);
                    e.dataTransfer.setData('id', el.id);
                    el.style.opacity = '0.5';
                });
                
                el.addEventListener('dragend', e => {
                    el.style.opacity = '1';
                });

                container.appendChild(el);
            });

            // Reset Zones
            document.querySelectorAll('.drop-zone').forEach(z => {
                // Keep header/text, remove buttons
                const buttons = z.querySelectorAll('.draggable');
                buttons.forEach(b => b.remove());
            });
        }

        function setupDropZones() {
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('dragover', e => {
                    e.preventDefault();
                    zone.classList.add('drag-over');
                });
                zone.addEventListener('dragleave', e => {
                    zone.classList.remove('drag-over');
                });
                zone.addEventListener('drop', e => {
                    e.preventDefault();
                    zone.classList.remove('drag-over');
                    const id = e.dataTransfer.getData('id');
                    const el = document.getElementById(id);
                    if (el) {
                        // Clone to new zone or move? Move is better logic here
                        zone.appendChild(el);
                    }
                });
            });
        }

        function checkDragDropAnswers() {
            let correct = 0;
            let total = 0;
            const zones = [
                {id: 'positiveZone', check: n => n > 0},
                {id: 'zeroZone', check: n => n === 0},
                {id: 'negativeZone', check: n => n < 0}
            ];

            zones.forEach(z => {
                const zoneEl = document.getElementById(z.id);
                const items = zoneEl.querySelectorAll('.draggable');
                items.forEach(item => {
                    total++;
                    const val = parseFloat(item.dataset.val);
                    if (z.check(val)) {
                        correct++;
                        item.classList.remove('btn-light', 'btn-danger');
                        item.classList.add('btn-success', 'text-white');
                    } else {
                        item.classList.remove('btn-light', 'btn-success');
                        item.classList.add('btn-danger', 'text-white');
                    }
                });
            });

            const resEl = document.getElementById('dragResult');
            if (total === 0) {
                resEl.innerHTML = "<span class='text-warning'>Hãy kéo số vào ô trước!</span>";
            } else if (correct === total && total === 5) {
                resEl.innerHTML = "<span class='text-success'>TUYỆT VỜI! ĐÚNG HẾT RỒI!</span>";
                confetti({particleCount: 100, spread: 70, origin: {y: 0.8}});
                playSound('success');
            } else {
                resEl.innerHTML = `<span class='text-primary'>Đúng ${correct}/${total}. Hãy thử lại nhé!</span>`;
            }
        }

        // ==================== INITIALIZATION ====================
        window.addEventListener('load', () => {
            // Hide Loader
            setTimeout(() => {
                document.getElementById('loader').classList.add('hidden');
            }, 600);

            // Init Components
            analyzeNumber();
            initFinanceChart();
            updateFinance(0);
            initDragDrop();
            setupDropZones();

            // Scroll Animations
            gsap.utils.toArray('.section-container').forEach(sec => {
                gsap.to(sec, {
                    opacity: 1,
                    y: 0,
                    duration: 0.8,
                    scrollTrigger: {
                        trigger: sec,
                        start: "top 85%",
                        toggleActions: "play none none reverse"
                    }
                });
            });
            
            // Handle Resize
            window.addEventListener('resize', () => {
                const input = document.getElementById('inputNum').value;
                const val = parseRational(input);
                if (!isNaN(val)) drawNumberLine(val);
            });
        });

    </script>
</body>
</html>
